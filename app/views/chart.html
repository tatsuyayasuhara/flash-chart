<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Chart</title>
    <style>
        .column3 div{
            width: calc(33.33% - 20px);
            float: left;
        }
        .column3 .one{
            margin-right: 20px;
            margin-left: 10px;
        }
        .column3 .two{
            margin-right: 20px;
        }
        .column3 .three{
            margin-right: 10px;
            float: end;
        }
    </style>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {packages: ['corechart', 'line']});

        var config = {
            externalVoltage: 9000,
            vacancyEnergy: 4.1,
            oxygenPressure: 0.21,
            heatCapacity: 56.188,
            title: "Furnace temperature dependence of power dissipation in flash sintering.",
            hAxis: {
                title: "Temperature /℃",
                window: {
                    max: 1500,
                    min: 500,
                }
            },
            vAxis: {
                title: "Power dissipation /10^9Wm^-3",
                window: {
                    max: 1.0,
                    min: 0,
                }
            },
            color: "#d80000",
        };

        function send () {
            var params = {
                "external_voltage": config.externalVoltage,
                "vacancy_energy": config.vacancyEnergy,
                "oxygen_pressure": config.oxygenPressure,
                "heat_capacity": config.heatCapacity,
            };
            $.get("/calc/flash/", params).done(function (data) {
                var dataTable = new google.visualization.DataTable();
                dataTable.addColumn('number', 'X');
                dataTable.addColumn('number', 'W');

                var googleChartData = [];
                for (i = 0; i < data["temperature"].values.length; i++){
                    var temp = data["temperature"].values[i];
                    var power = data["power_dissipation"].values[i]/1.0e+9;
                    var datas = [temp, power];
                    googleChartData.push(datas)
                }
                dataTable.addRows(googleChartData);

                var options = {
                    legend: {
                        position: "none"
                    },
                    title: config.title,
                    titleTextStyle: {
                        fontSize: 20
                    },
                    hAxis: {
                        title: config.hAxis.title,
                        viewWindow: {
                            max: config.hAxis.window.max,
                            min: config.hAxis.window.min,
                        },
                        titleTextStyle: {
                            italic: false,
                            bold: true,
                        }
                    },
                    vAxis: {
                        title: config.vAxis.title,
                        viewWindow: {
                            max: config.vAxis.window.max,
                            min: config.vAxis.window.min,
                        },
                        titleTextStyle: {
                            italic: false,
                            bold: true,
                        }
                    },
                    colors: [config.color],
                };
                var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
                chart.draw(dataTable, options);
            })
        }

        window.onload = function () {
            send();
            $('#input_ev_txt').change(function () { send_ev(this.value); });
            $('#input_ev_sld').change(function () { send_ev(this.value); });
            $('#input_ve_txt').change(function () { send_ve(this.value); });
            $('#input_ve_sld').change(function () { send_ve(this.value); });
            $('#input_pO2_txt').change(function () { send_pO2(this.value); });
            $('#input_pO2_sld').change(function () { send_pO2(this.value); });
            $('#input_cp_txt').change(function () { send_cp(this.value); });
        };

        function send_ev(num) {
            config.externalVoltage = num;
            document.getElementById('output_ev').value = num;
            document.getElementById('input_ev_sld').value = num;
            send();
        }
        function send_ve(num) {
            config.vacancyEnergy = num;
            document.getElementById('output_ve').value = num;
            document.getElementById('input_ve_sld').value = num;
            send();
        }
        function send_pO2(num) {
            config.oxygenPressure = num;
            document.getElementById('output_pO2').value = num;
            document.getElementById('input_pO2_sld').value = num;
            send();
        }
        function send_cp(num) {
            config.heatCapacity = num;
            send();
        }
        function changing_ev(num) {
            document.getElementById('output_ev').value = num;
            document.getElementById('input_ev_txt').value = num;
        }
        function changing_ve(num) {
            document.getElementById('output_ve').value = num;
            document.getElementById('input_ve_txt').value = num;
        }
        function changing_pO2(num) {
            document.getElementById('output_pO2').value = num;
            document.getElementById('input_pO2_txt').value = num;
        }
    </script>
</head>
<body>

<div id="chart_div" style="width: 900px; height: 500px; margin: auto"></div>

<section class="column3">
    <div class="one">
        <h3>外部電圧：<output id="output_ev">9000</output>[V/m]<br></h3>
        <input id="input_ev_sld" type="range" value="9000" min="0" max="20000" step="100" style="margin-left: 10px"
               oninput="changing_ev(this.value)" list="marks_ev">
        <input id="input_ev_txt" type="text" value="9000" style="width: 50px; margin-left: 10px">(入力用)
    </div>
    <div class="two">
        <h3>空孔形成エネルギー：<output id="output_ve">4.1</output>[eV]<br></h3>
        <input id="input_ve_sld" type="range" value="4.1" min="3" max="5.5" step="0.01" style="margin-left: 10px"
               oninput="changing_ve(this.value)" list="marks_ve">
        <input id="input_ve_txt" type="text" value="4.1" style="width: 50px; margin-left: 10px">(入力用)
    </div>
    <div class="three">
        <h3>酸素分圧：<output id="output_pO2">0.21</output><br></h3>
        <input id="input_pO2_sld" type="range" value="0.21" min="0" max="0.3" step="0.00001" style="margin-left: 10px"
               oninput="changing_pO2(this.value)" list="marks_pO2">
        <input id="input_pO2_txt" type="text" value="0.21" style="width: 50px; margin-left: 10px">(入力用)
    </div>
</section>

<section class="column3">
    <div class="one">
        <h3>モル熱容量：<input id="input_cp_txt" type="text" value="56.188" style="width: 50px; margin-left: 10px">[J/molK]</h3>
    </div>
</section>

<datalist id="marks_ev">
    <option value="0"></option>
    <option value="5000"></option>
    <option value="10000"></option>
    <option value="15000"></option>
    <option value="20000"></option>
</datalist>
<datalist id="marks_ve">
    <option value="3.0"></option>
    <option value="3.5"></option>
    <option value="4.0"></option>
    <option value="4.5"></option>
    <option value="5.0"></option>
    <option value="5.5"></option>
</datalist>
<datalist id="marks_pO2">
    <option value="0"></option>
    <option value="0.1"></option>
    <option value="0.2"></option>
    <option value="0.3"></option>
</datalist>

</body>
</html>
